<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Keypad Soundboard</title>
    <link rel="icon"
        href="https://www.raspberrypi.com/app/uploads/2021/10/cropped-Raspberry-Pi-Favicon-100x100-1-300x300.png"
        type="image/png">
</head>

<body>
    <div>
        <p>Built with a Raspberry Pi Pico W</p>
        <img src="https://www.raspberrypi.com/app/uploads/2021/10/cropped-Raspberry-Pi-Favicon-100x100-1-300x300.png"
            alt="Logo">
    </div>
    <div id="connected">
        Not connected
    </div>
    <div id="heart">
        Off
    </div>
    <hr>

    <input type="button" value="PLAY" onclick="play()">
    <audio id="audio"
        src="https://raw.githubusercontent.com/elijah-nelson/KeypadSoundboard/main/ignore/resources/wahwahtrumpet.wav">
    </audio>

    <div id="response">
        Received:
    </div>

    <script>
        // Constants
        const defaultHostname = "10.1.1.159";
        const ws = new WebSocket("ws://" + (location.hostname ? location.hostname : defaultHostname) + ":80");
        const stateMap = new Map([
            [ws.CLOSED, "Closed"],
            [ws.CLOSING, "Closing"],
            [ws.CONNECTING, "Connecting"],
            [ws.OPEN, "Open"]
        ]);

        // Elements
        const connectedElement = document.getElementById("connected");

        // Global variables
        var heartOn = false;

        const checkConnected = function () {
            if (stateMap.has(ws.readyState)) {
                connectedElement.innerText = stateMap.get(ws.readyState);
            } else {
                connectedElement.innerText = "unknown state: " + ws.readyState;
            }
            if (ws.readyState !== ws.OPEN) {
                setTimeout(checkConnected, 1000);
            }
        }
        checkConnected();

        ws.onopen = function (evt) {
            console.log(evt);
            connectedElement.innerText = "Connected!";
            ws.send("Hello");
        };

        ws.onmessage = function (evt) {
            if (evt.data === "heartbeat") {
                heartOn = !heartOn;
                document.getElementById("heart").innerText = (heartOn) ? "On" : "Off";
                return;
            }

            document.getElementById("response").innerHTML += "<br>" + evt.data;
        };

        ws.onclose = function () {
            document.getElementById("connected").innerText = "Disconnected...";
        }

        function play() {
            var audio = document.getElementById("audio");
            audio.play();
        }
    </script>
</body>

</html>